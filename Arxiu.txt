globals [
  AiguaTotal
]

turtles-own[
  Vida
  Velocitat
  InaniciÃ³
  Fertilitat
  PeriodeFertilitat
  Cries
  MaduresaCries
]

patches-own[
  Aigua;color 95
  Terra; color 65
  cau; color 34
  Teranyina; color 9
]


breed [Guineus Guineu]
breed [Talps Talp]
breed [Carnivores Carnivora]
breed [Flors Flor]
breed [Aranyes Aranya]
breed [Granotes Granota]
breed [Papallones Papallona]
breed [Fenomens Fenomen]

talps-own [
  direccio
]

to setup
  
  clear-all
  reset-ticks
     ask Patches [
    set aigua false;color 95
    set terra true; color 65
    set cau false; color 34
    set teranyina false; color 965
    set pcolor 65
    set aiguatotal aiguatotal - 900

      if (pxcor > 0 and pxcor < 150 and pycor > 0 and pycor < 150)[
      set pcolor 95
      set aigua true
      set terra false
      ask neighbors [
         set pcolor 95
         set aigua true
         set terra false
        ask neighbors [
         set pcolor 95
         set aigua true
         set terra false
           ask neighbors [
         set pcolor 95
         set aigua true
         set terra false
            ]
     ]

     ]
    ]
  ]


  create-Guineus GuineusTotal[
    setxy random-xcor random-ycor
    set shape "wolf"
    set color blue
    set size 6
  ]
  create-Talps TalpsTotal[
    setxy random-xcor random-ycor
    set shape "bug"
    set color orange
    set size 6
    set Vida 150
  ]
  create-Carnivores CarnivoresTotal[
    setxy random-xcor random-ycor
    set shape "plant"
    set color blue
    set size 6
  ]
  create-Flors FlorsTotal[
    setxy random-xcor random-ycor
    set shape "flower"
    set color blue
    set size 6
  ]
  create-Aranyes AranyesTotal[
    setxy random-xcor random-ycor
    set shape "spider"
    set color blue
    set size 6
  ]
  create-Granotes GranotesTotal[
    setxy random-xcor random-ycor
    set shape "turtle"
    set color blue
    set size 6
  ]
  create-Papallones PapallonesTotal[
    setxy random-xcor random-ycor
    set shape "butterfly"
    set color blue
    set size 6
  ]
  create-Fenomens FenomenTotal[
    setxy random-xcor random-ycor
    set shape "arrow"
    set color blue
    set size 10
  ]

end

to morir-granota [qui]
  die
end

to morir-papallona [qui]
  die
end

to morir-aranya [qui]
  die
end


to go
  ask turtles [
    moure-generic
    eat-generic
  ]
  ask talps [
    set Vida Vida + 1
    talps-moure
  ]
  tick
end

to moure-generic ; turtle procedure
   ifelse breed = Flors or breed = Carnivores or breed = Talps[
  ]
  [
    rt random-float 90 - random-float 90
    fd 1
  ]
end

to talps-cau 
  ask patch-here [
      set cau true
      set pcolor 34
    ]

  hatch 3[
    setxy random-xcor random-ycor
    set shape "bug"
    set color orange
    set size 6
    set Vida 150
  ]
end

to talps-moure
    if ([aigua] of patch-here = true) [die]
    
    talps-cau
    
    rt random-float 90 - random-float 90
    ;Comprovacio si anem a moure'ns fora del mapa
    ifelse (0 <= heading or heading <= 90) [
      
    ]
    [
      ifelse (90 <= heading or heading <= 180) [
        
      ]
      [
        ifelse (180 <= heading or heading <= 270) [
          
        ]
        [
          
        ]
      ]
    ]
    fd 2
end

to eat-generic ;
  if breed = Papallones and (count Flors-here > 0)
  [
    set color red
  ]
  if breed = Aranyes and (count Papallones-here > 0)
  [
    let presa one-of papallones-here
    ask presa[ morir]
    beep
  ]
  if breed = Talps and (count Aranyes-here > 0 or count Granotes-here > 0 or count Papallones-here > 0)
  [
    ifelse (count Granotes-here > 0)[
      let presa one-of Granotes-here
      ask presa [morir-granota myself]
      beep
    ]
    [
      ifelse (count Papallones-here > 0)[
      let presa one-of Papallones-here
      ask presa [morir-papallona myself]
      beep
      ]
      [
        let presa one-of Aranyes-here
        ask presa [morir-aranya myself]
        beep
      ]
    ]
  ]
  if breed = Granotes and (count Talps-here > 0)
  [
    let presa one-of Talps-here
    ask presa[ morir]
    beep
  ]
  if breed = Carnivores and (count Papallones-here > 0 or count Aranyes-here > 0)
  [
 
    ifelse (count Aranyes-here > 0)[
      let presa one-of Aranyes-here
      ask presa [morir]
      beep
    ]
    [
      let presa one-of Papallones-here
      ask presa[ morir]
      beep
    ]
  ]
  if breed = Guineus and (count Talps-here > 0 or count Granotes-here > 0)
  [
    ifelse (count Talps-here > 0)[
      let presa one-of Talps-here
      ask presa[ morir]
      beep
    ]
    [
      let presa one-of Granotes-here
      ask presa[ morir]
      beep
    ]
  ]
end

to morir
  set color red
  die
end
